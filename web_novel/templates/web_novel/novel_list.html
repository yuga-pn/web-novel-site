{% extends "web_novel/base.html" %}
{% block content %}

{% if search_query or tag_filter or work_filter %}
    <div class="alert alert-info mb-4" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border: none; border-radius: 12px;">
        {% if work_filter %}
            <h5 class="mb-2">ğŸ“š åŸä½œãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h5>
            <p class="mb-2">åŸä½œã€Œ<strong>{{ work_filter }}</strong>ã€ã®å°èª¬: {{ novels|length }} ä»¶</p>
            <a href="{% url 'novel_list' %}" class="btn btn-sm btn-outline-primary">
                ğŸ”„ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’è§£é™¤
            </a>
        {% elif tag_filter %}
            <h5 class="mb-2">ğŸ·ï¸ ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h5>
            <p class="mb-2">ã‚¿ã‚°ã€Œ<strong>{{ tag_filter }}</strong>ã€ã®å°èª¬: {{ novels|length }} ä»¶</p>
            <a href="{% url 'novel_list' %}" class="btn btn-sm btn-outline-primary">
                ğŸ”„ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’è§£é™¤
            </a>
        {% elif search_query %}
            <h5 class="mb-2">ğŸ” æ¤œç´¢çµæœ</h5>
            <p class="mb-0">ã€Œ<strong>{{ search_query }}</strong>ã€ã®æ¤œç´¢çµæœ: {{ novels|length }} ä»¶</p>
        {% endif %}
    </div>
{% endif %}

{% for nov in novels %}
    <div class="novel-card card">
        <div class="card-body">
            <h3 class="novel-title">
                <a class="text-decoration-none" href="{{nov.linked}}" target="_blank">
                    ğŸ“– {{nov.title}}
                </a>
            </h3>
            <div class="novel-meta">
                <strong>åŸä½œï¼š</strong>
                {% if nov.original_work %}
                    {{nov.original_work.name}}
                {% else %}
                    {{nov.work_name|default:"æœªè¨­å®š"}}
                {% endif %}
            </div>
            <div class="novel-meta">
                <strong>ç·æ–‡å­—æ•°ï¼š</strong>
                {% if nov.word_count %}
                    {{nov.word_count|floatformat:0}}æ–‡å­—
                {% else %}
                    {{nov.word_num|default:"æœªè¨­å®š"}}æ–‡å­—
                {% endif %}
            </div>
            <div class="mb-3">
                <strong>ğŸ·ï¸ ã‚¿ã‚°ï¼š</strong>
                {% if nov.tags.all %}
                    {% for tag in nov.tags.all %}
                        <a href="{% url 'novel_list' %}?tag={{tag.name|urlencode}}" class="text-decoration-none">
                            <span class="tag-badge" style="background-color: {{tag.color}}; color: white; padding: 2px 6px; border-radius: 3px; margin-right: 5px; cursor: pointer; transition: opacity 0.2s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">{{tag.name}}</span>
                        </a>
                    {% endfor %}
                {% else %}
                    {% if nov.tag %}
                        {% for split_tag in nov.get_split_tags %}
                            <a href="{% url 'novel_list' %}?tag={{split_tag|urlencode}}" class="text-decoration-none">
                                <span class="tag-badge" style="background-color: #3498db; color: white; padding: 2px 6px; border-radius: 3px; margin-right: 5px; cursor: pointer; transition: opacity 0.2s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">{{split_tag}}</span>
                            </a>
                        {% endfor %}
                    {% else %}
                        <span class="tag-badge">ã‚¿ã‚°ãªã—</span>
                    {% endif %}
                {% endif %}
            </div>
            <div class="d-flex justify-content-end">
                <a class="detail-btn" href="{% url 'novel_detail' nov.pk %}">
                    ğŸ“š è©³ç´°ã‚’è¦‹ã‚‹
                </a>
            </div>
        </div>
    </div>
{% empty %}
    <div class="text-center py-5">
        <h4 class="text-muted">å°èª¬ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</h4>
        <p class="text-muted">åˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„</p>
    </div>
{% endfor %}

{% endblock content %}